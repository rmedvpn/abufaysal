@page
@using Faysal.Helpers
@inject IHttpContextAccessor HttpContextAccessor
@{
    Layout = "~/Pages/Shared/Layouts/_Mini.cshtml";

    var context = HttpContextAccessor.HttpContext!;
    var request = context.Request;
    var response = context.Response;

    var errors = new List<string>();
    string userName = "", password = "";

 

    // ✅ Handle POST login
    // ✅ Handle POST login
    if (request.Method == "POST")
    {
        userName = request.Form["UserName"];
        password = request.Form["Password"];
        bool rememberMe = request.Form.ContainsKey("rememberMe"); // <-- checked => true

        if (string.IsNullOrWhiteSpace(userName))
            errors.Add("שם משתמש הוא שדה חובה");
        if (string.IsNullOrWhiteSpace(password))
            errors.Add("חובה להזין סיסמא");

        if (!errors.Any())
        {
            if (WebSecurity.Login(userName, password, rememberMe))
            {
                AppFunctions.DoLogin(WebSecurity.CurrentUserId); // <-- pass rememberMe
                response.Redirect("/");
                return;
            }
            else
            {
                errors.Add("התחברות נכשלה");
            }
        }
    }
}

<section class="wel_sec" style="text-align:center">
    <div class="container" >
        <center>
            <div class="top_spacer"></div>
            <img class="logo" src="images/logo_n.png" />
            <div class="B" style="text-align:center;margin-top:25px;">

                <div class="loginHeader">
                    התחברות
                </div>
                <div class="tx_block" style="font-size:20px;color:#fff;">

                    <form method="post">



                        <input type="text" class="Login_tb" name="UserName" placeholder="משתמש" autocomplete="username" value="@userName" />
                        <input type="password" class="Login_tb" name="Password" placeholder="סיסמא" autocomplete="current-password"  />
                        @if (errors.Any())
                        {
                            <div class="regErrMsg2">
                                @foreach (var e in errors)
                                {
                                    <div>@e</div>
                                }
                            </div>
                        }

                        <div class="loginQuestion" >
                            <input type="checkbox" name="rememberMe" checked style="padding:5px;margin-left:5px;height:20px;width:20px;" />
                            לזכור אותך?
                        </div>


                        <button type="submit" class="LoginBigBtn" onclick="document.forms[0].submit();">התחברות</button>
                        <button type="button" class="LoginBigBtn" onclick="window.location.href='ForgotPassword';">שכחת סיסמא?</button>
                        <button type="button" class="LoginBigBtn" onclick="window.location.href='Register';">הרשמה</button>


                        <div class="B" style="height:150px;">&nbsp;</div>

                    </form>


                </div>
                <br />


            </div>

        </center>
    </div>

</section>



<center>
    <div class="copyDisc">
        <center>2025 &copy; מערכות ישראל</center>
    </div>
</center>